<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ALISHASHOP N√©goce</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap');
        body { font-family: 'Outfit', sans-serif; background: #0f172a; color: white; -webkit-tap-highlight-color: transparent; }
        
        /* THEMES */
        .bg-home { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); } 
        .bg-shop { background: linear-gradient(135deg, #EA580C 0%, #C2410C 100%); } 
        .bg-service { background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%); } 
        .bg-money { background: linear-gradient(135deg, #059669 0%, #047857 100%); } 
        .bg-stock { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); } 

        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-radius: 20px; color: #1e293b; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .glass-dark { background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(12px); color: white; border-radius: 20px; }
        
        .btn-press:active { transform: scale(0.96); transition: 0.1s; }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const formatMoney = (n) => new Intl.NumberFormat('fr-FR').format(n) + ' F';
        const generateId = () => Math.random().toString(36).substr(2, 6).toUpperCase();

        const OPERATORS = [
            { name: 'Wave', color: 'bg-sky-400' },
            { name: 'Orange Money', color: 'bg-orange-500' },
            { name: 'Free Money', color: 'bg-red-600' },
            { name: 'Wizall', color: 'bg-blue-700' }
        ];

        // --- CATALOGUE (Extrait du PDF) ---
        [cite_start]// [cite: 1] Catalogue_Complet_Accessoires_Telephones_Informatique.pdf
        const INIT_PRODUCTS = [
            { id: 'P01', name: 'Coque silicone Antichoc', price: 4500, stock: 20 },
            { id: 'P02', name: 'Coque rigide Premium', price: 6000, stock: 15 },
            { id: 'P03', name: 'Verre tremp√© 9H', price: 2000, stock: 50 },
            { id: 'P04', name: 'Film hydrogel', price: 2500, stock: 30 },
            { id: 'P05', name: 'Chargeur rapide 25W', price: 6000, stock: 20 },
            { id: 'P06', name: 'Chargeur 33W Fast Charge', price: 7500, stock: 15 },
            { id: 'P07', name: 'Chargeur voiture Double USB', price: 3500, stock: 15 },
            { id: 'P08', name: 'C√¢ble USB-C (1m)', price: 1500, stock: 40 },
            { id: 'P09', name: 'C√¢ble Lightning iPhone', price: 3000, stock: 25 },
            { id: 'P10', name: 'C√¢ble Micro-USB (1m)', price: 1000, stock: 30 },
            { id: 'P11', name: 'Power Bank 10000mAh', price: 9000, stock: 20 },
            { id: 'P12', name: 'Power Bank 20000mAh', price: 14000, stock: 10 },
            { id: 'P13', name: '√âcouteurs filaires Jack', price: 2500, stock: 40 },
            { id: 'P14', name: '√âcouteurs Bluetooth 5.0', price: 12000, stock: 25 },
            { id: 'P15', name: 'Casque Bluetooth 12h', price: 18000, stock: 15 },
            { id: 'P16', name: 'Mini enceinte BT 10W', price: 15000, stock: 15 },
            { id: 'P17', name: 'Support voiture Grille', price: 4000, stock: 20 },
            { id: 'P18', name: 'Support bureau M√©tal', price: 5000, stock: 15 },
            { id: 'P19', name: 'Anneau support (Ring)', price: 1000, stock: 30 },
            { id: 'P20', name: 'Batterie interne universelle', price: 4000, stock: 40 },
            { id: 'P21', name: 'Bague magn√©tique MagSafe', price: 2000, stock: 25 },
            { id: 'P22', name: 'Chargeur sans fil Qi 15W', price: 10000, stock: 10 },
            { id: 'P23', name: 'Ventilateur t√©l√©phone', price: 7000, stock: 8 },
            { id: 'P24', name: 'Lampe selfie LED', price: 4500, stock: 20 },
            { id: 'P25', name: 'Tr√©pied smartphone 1m', price: 9000, stock: 12 },
            { id: 'P26', name: 'Carte m√©moire 32Go', price: 5000, stock: 20 },
            { id: 'P27', name: 'Carte m√©moire 64Go', price: 8000, stock: 25 },
            { id: 'P28', name: 'Adaptateur OTG USB-C', price: 1200, stock: 30 },
            { id: 'P29', name: 'Adaptateur SIM Kit', price: 500, stock: 40 },
            { id: 'P30', name: 'Aiguille extracteur SIM', price: 200, stock: 100 },
            { id: 'P31', name: 'Brosse nettoyage Microfibre', price: 1500, stock: 35 },
            { id: 'P32', name: 'Mini aspirateur USB', price: 12000, stock: 10 },
            { id: 'P33', name: 'Clavier filaire USB', price: 9500, stock: 15 },
            { id: 'P34', name: 'Clavier sans fil 2.4G', price: 12000, stock: 10 },
            { id: 'P35', name: 'Souris filaire 1000DPI', price: 5000, stock: 20 },
            { id: 'P36', name: 'Souris sans fil USB', price: 7500, stock: 15 },
            { id: 'P37', name: 'Combo Clavier-Souris sans fil', price: 15000, stock: 10 },
            { id: 'P38', name: 'Tapis de souris', price: 1500, stock: 30 },
            { id: 'P39', name: 'Hub USB 3.0 (4 ports)', price: 8000, stock: 10 },
            { id: 'P40', name: 'Cl√© USB 32Go 3.0', price: 6000, stock: 25 },
            { id: 'P41', name: 'Cl√© USB 64Go 3.0', price: 8000, stock: 20 },
            { id: 'P42', name: 'Disque Dur Externe 1To', price: 45000, stock: 8 },
            { id: 'P43', name: 'C√¢ble HDMI 1.5m', price: 3500, stock: 30 },
            { id: 'P44', name: 'C√¢ble HDMI 3m', price: 5000, stock: 20 },
            { id: 'P45', name: 'C√¢ble Alim PC (3 broches)', price: 2500, stock: 20 },
            { id: 'P46', name: 'Chargeur PC Universel 65W', price: 18000, stock: 10 },
            { id: 'P47', name: 'Ventilateur PC Portable', price: 12000, stock: 10 },
            { id: 'P48', name: 'Adaptateur VGA-HDMI', price: 6000, stock: 15 },
            { id: 'P49', name: 'Adaptateur USB-C HDMI 4K', price: 10000, stock: 12 },
            { id: 'P50', name: 'Adaptateur USB-C Ethernet', price: 11000, stock: 10 },
            { id: 'P51', name: 'Casque filaire PC Micro', price: 10000, stock: 12 },
            { id: 'P52', name: 'Microphone USB Podcast', price: 15000, stock: 10 },
            { id: 'P53', name: 'Webcam HD 1080p', price: 18000, stock: 8 },
            { id: 'P54', name: 'Multiprise 6 ports', price: 12000, stock: 10 }
        ];

        const INIT_SERVICES = [
            { id: 'S1', name: 'Photocopie N&B', price: 50, icon: 'copy' },
            { id: 'S2', name: 'Photocopie Couleur', price: 100, icon: 'palette' },
            { id: 'S3', name: 'Reliure', price: 1000, icon: 'book' },
            { id: 'S4', name: 'Scanner', price: 200, icon: 'scan' },
            { id: 'S5', name: 'Photo Identit√©', price: 2000, icon: 'camera' }
        ];

        // --- COMPOSANTS LOGIN & HEADER ---
        const Login = ({ onLogin }) => {
            const [role, setRole] = useState(null);
            const [pin, setPin] = useState("");
            const handlePin = (n) => {
                const next = pin + n;
                setPin(next);
                if (next.length === 4) {
                    if (role === 'ADMIN' && next === '1234') onLogin({ name: 'Patron', role: 'ADMIN' });
                    else if (role === 'STAFF' && next === '0000') onLogin({ name: 'Vendeur', role: 'STAFF' });
                    else { alert("Code Incorrect"); setPin(""); }
                }
            };
            return (
                <div className="min-h-screen bg-gray-900 flex flex-col items-center justify-center p-6">
                    <h1 className="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-pink-500 mb-8">ALISHASHOP</h1>
                    {!role ? (
                        <div className="grid gap-4 w-full max-w-sm slide-up">
                            <button onClick={()=>setRole('ADMIN')} className="glass p-6 flex items-center gap-4 btn-press">
                                <div className="bg-purple-100 p-3 rounded-full"><i data-lucide="crown" className="text-purple-600"></i></div>
                                <div className="text-left"><h3 className="font-bold">Espace Patron</h3><p className="text-xs text-gray-500">Stock & Gestion</p></div>
                            </button>
                            <button onClick={()=>setRole('STAFF')} className="glass p-6 flex items-center gap-4 btn-press">
                                <div className="bg-orange-100 p-3 rounded-full"><i data-lucide="user" className="text-orange-600"></i></div>
                                <div className="text-left"><h3 className="font-bold">Espace Vendeur</h3><p className="text-xs text-gray-500">Caisse</p></div>
                            </button>
                        </div>
                    ) : (
                        <div className="w-full max-w-xs slide-up text-center">
                            <p className="text-white mb-6 font-bold">Code PIN {role}</p>
                            <div className="flex justify-center gap-4 mb-6">{[0,1,2,3].map(i=><div key={i} className={`w-3 h-3 rounded-full ${pin.length>i?'bg-orange-500':'bg-gray-600'}`}></div>)}</div>
                            <div className="grid grid-cols-3 gap-4">
                                {[1,2,3,4,5,6,7,8,9,0].map(n => (<button key={n} onClick={()=>handlePin(n)} className="h-16 bg-white/10 rounded-xl text-2xl font-bold text-white btn-press">{n}</button>))}
                                <button onClick={()=>setRole(null)} className="h-16 bg-red-500/20 rounded-xl text-red-500 flex items-center justify-center"><i data-lucide="x"></i></button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const Header = ({ title, onBack, onLogout, user, cartCount, onOpenCart }) => (
            <div className="p-4 pt-6 sticky top-0 z-30 bg-black/20 backdrop-blur shadow-sm flex justify-between items-center mb-4">
                <div className="flex items-center gap-3">
                    {onBack && <button onClick={onBack} className="p-2 bg-white/20 rounded-full btn-press"><i data-lucide="arrow-left" className="text-white"></i></button>}
                    <div><h2 className="font-black text-xl text-white uppercase">{title}</h2><p className="text-xs text-white/70 font-bold">{user.name}</p></div>
                </div>
                <div className="flex gap-2">
                    {cartCount !== undefined && (
                        <button onClick={onOpenCart} className="relative p-2 bg-orange-500 text-white rounded-full btn-press shadow-lg border-2 border-white">
                            <i data-lucide="shopping-cart"></i>
                            {cartCount > 0 && <span className="absolute -top-2 -right-2 bg-red-600 text-white text-xs font-bold w-6 h-6 flex items-center justify-center rounded-full border border-white">{cartCount}</span>}
                        </button>
                    )}
                    <button onClick={onLogout} className="p-2 bg-white/10 rounded-full btn-press"><i data-lucide="refresh-cw" className="text-white"></i></button>
                </div>
            </div>
        );

        // --- COMPOSANT PANIER (AVEC MODIF PRIX) ---
        const CartModal = ({ cart, updateCartItem, removeFromCart, onCheckout, onClose }) => {
            const total = cart.reduce((a,c)=>a+(c.price*c.qty),0);
            
            return (
                <div className="fixed inset-0 z-50 bg-black/90 backdrop-blur-sm flex flex-col slide-up">
                    <div className="p-4 flex justify-between items-center bg-gray-800 border-b border-gray-700">
                        <h2 className="text-2xl font-black text-white flex items-center gap-2"><i data-lucide="shopping-cart"></i> MON PANIER</h2>
                        <button onClick={onClose} className="p-2 bg-gray-700 rounded-full text-white"><i data-lucide="x"></i></button>
                    </div>
                    
                    <div className="flex-1 overflow-y-auto p-4 space-y-3">
                        {cart.length === 0 ? (
                            <div className="text-center text-gray-500 mt-20">
                                <i data-lucide="shopping-bag" className="w-16 h-16 mx-auto mb-4 opacity-50"></i>
                                <p>Le panier est vide</p>
                            </div>
                        ) : (
                            cart.map(item => (
                                <div key={item.id} className="bg-white rounded-xl p-4 shadow-lg text-gray-800 animate-fade-in">
                                    <div className="flex justify-between items-start mb-3">
                                        <h3 className="font-bold text-lg leading-tight w-2/3">{item.name}</h3>
                                        <button onClick={()=>removeFromCart(item.id)} className="text-red-500 bg-red-50 p-1 rounded"><i data-lucide="trash-2" className="w-5 h-5"></i></button>
                                    </div>
                                    
                                    <div className="flex items-center gap-4 bg-gray-50 p-2 rounded-lg">
                                        {/* Quantit√© */}
                                        <div className="flex items-center gap-2 bg-white rounded-lg border p-1 shadow-sm">
                                            <button onClick={()=>updateCartItem(item.id, 'qty', Math.max(1, item.qty-1))} className="w-8 h-8 bg-gray-200 rounded font-bold">-</button>
                                            <span className="font-black w-6 text-center">{item.qty}</span>
                                            <button onClick={()=>updateCartItem(item.id, 'qty', item.qty+1)} className="w-8 h-8 bg-gray-200 rounded font-bold">+</button>
                                        </div>
                                        
                                        {/* PRIX EDITABLE */}
                                        <div className="flex-1">
                                            <label className="text-[10px] font-bold text-gray-400 uppercase">Prix Unitaire (Modifiable)</label>
                                            <div className="flex items-center border-b-2 border-orange-200">
                                                <input 
                                                    type="number" 
                                                    value={item.price} 
                                                    onChange={(e)=>updateCartItem(item.id, 'price', parseInt(e.target.value) || 0)}
                                                    className="w-full bg-transparent font-black text-xl text-orange-600 outline-none"
                                                />
                                                <span className="text-xs font-bold text-orange-400">F</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="text-right mt-2 text-sm font-bold text-gray-400">
                                        Sous-total: <span className="text-gray-800">{formatMoney(item.price * item.qty)}</span>
                                    </div>
                                </div>
                            ))
                        )}
                    </div>
                    
                    {cart.length > 0 && (
                        <div className="p-4 bg-gray-800 border-t border-gray-700">
                            <div className="flex justify-between items-center mb-4 text-white">
                                <span className="font-bold text-gray-400">TOTAL √Ä PAYER</span>
                                <span className="text-3xl font-black text-green-400">{formatMoney(total)}</span>
                            </div>
                            <button onClick={onCheckout} className="w-full py-4 bg-green-500 hover:bg-green-600 text-white rounded-2xl font-black text-xl shadow-lg btn-press flex justify-center items-center gap-2">
                                <i data-lucide="check-circle"></i> VALIDER LA VENTE
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        const DashboardStats = ({ transactions, onClose }) => {
            const today = new Date().toLocaleDateString();
            const todayTx = transactions.filter(t => new Date(t.date).toLocaleDateString() === today);
            const salesShop = todayTx.filter(t => t.cat === 'SHOP').reduce((a,t)=>a+t.amount, 0);
            const salesService = todayTx.filter(t => t.cat === 'SERVICE').reduce((a,t)=>a+t.amount, 0);
            const totalRevenue = salesShop + salesService;
            const getOpStats = (opName) => {
                const txs = todayTx.filter(t => t.cat === 'MONEY' && t.operator === opName);
                return {
                    depot: txs.filter(t => t.type === 'DEPOSIT').reduce((a,t)=>a+t.amount, 0),
                    retrait: txs.filter(t => t.type === 'WITHDRAW').reduce((a,t)=>a+t.amount, 0)
                };
            };
            return (
                <div className="fixed inset-0 bg-gray-900/95 z-50 p-4 overflow-y-auto animate-fade-in">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-black text-white">BILAN DU JOUR</h2>
                        <button onClick={onClose} className="p-2 bg-gray-700 rounded-full"><i data-lucide="x"></i></button>
                    </div>
                    <div className="bg-gradient-to-r from-green-600 to-emerald-600 rounded-2xl p-6 mb-6 shadow-lg">
                        <div className="flex items-center gap-2 mb-2 opacity-80">
                            <i data-lucide="trending-up"></i><span className="font-bold text-sm tracking-widest">CHIFFRE D'AFFAIRES</span>
                        </div>
                        <p className="text-4xl font-black text-white mb-4">{formatMoney(totalRevenue)}</p>
                        <div className="flex gap-4 text-sm bg-black/20 p-3 rounded-xl">
                            <div className="flex-1">üõçÔ∏è Boutique: <b>{formatMoney(salesShop)}</b></div>
                            <div className="flex-1">üñ®Ô∏è Services: <b>{formatMoney(salesService)}</b></div>
                        </div>
                    </div>
                    <h3 className="font-bold text-gray-400 mb-3 uppercase text-sm">Mobile Money</h3>
                    <div className="space-y-3 mb-8">
                        {OPERATORS.map(op => {
                            const stats = getOpStats(op.name);
                            if(stats.depot === 0 && stats.retrait === 0) return null;
                            return (
                                <div key={op.name} className="bg-white rounded-xl p-4 text-gray-800 shadow-sm">
                                    <div className="flex items-center gap-2 mb-2">
                                        <div className={`w-3 h-3 rounded-full ${op.color}`}></div>
                                        <span className="font-black uppercase">{op.name}</span>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="bg-green-50 p-2 rounded-lg border border-green-100"><p className="text-xs text-green-600 font-bold">D√âP√îTS</p><p className="font-black text-lg">{formatMoney(stats.depot)}</p></div>
                                        <div className="bg-red-50 p-2 rounded-lg border border-red-100"><p className="text-xs text-red-600 font-bold">RETRAITS</p><p className="font-black text-lg">{formatMoney(stats.retrait)}</p></div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const AdminStock = ({ products, onAddStock, onNewProduct }) => {
            const [mode, setMode] = useState('EXISTING'); 
            const [newProd, setNewProd] = useState({ name: '', price: '', stock: '' });

            return (
                <div className="p-4 slide-up">
                    <div className="glass p-6 mb-4">
                        <div className="flex bg-gray-100 rounded-xl p-1 mb-4">
                            <button onClick={()=>setMode('EXISTING')} className={`flex-1 py-2 rounded-lg font-bold text-sm ${mode==='EXISTING'?'bg-white shadow text-purple-600':'text-gray-500'}`}>Arrivage Rapide</button>
                            <button onClick={()=>setMode('NEW')} className={`flex-1 py-2 rounded-lg font-bold text-sm ${mode==='NEW'?'bg-white shadow text-purple-600':'text-gray-500'}`}>Cr√©er Nouveau</button>
                        </div>
                        {mode === 'EXISTING' ? (
                            <div>
                                <select id="p-select" className="w-full p-3 bg-gray-100 rounded-xl font-bold mb-2 text-gray-800">
                                    {products.map(p=><option key={p.id} value={p.id}>{p.name}</option>)}
                                </select>
                                <div className="flex gap-2">
                                    <input id="p-qty" type="number" placeholder="Qt√© re√ßue" className="w-1/2 p-3 bg-gray-100 rounded-xl font-bold text-gray-800"/>
                                    <button onClick={() => {
                                        const id = document.getElementById('p-select').value;
                                        const qty = parseInt(document.getElementById('p-qty').value);
                                        if(qty) onAddStock(id, qty);
                                    }} className="w-1/2 bg-purple-600 text-white rounded-xl font-bold btn-press">AJOUTER</button>
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-3">
                                <input type="text" placeholder="Nom du produit" value={newProd.name} onChange={e=>setNewProd({...newProd, name: e.target.value})} className="w-full p-3 bg-gray-100 rounded-xl font-bold text-gray-800"/>
                                <div className="flex gap-2">
                                    <input type="number" placeholder="Prix Vente" value={newProd.price} onChange={e=>setNewProd({...newProd, price: e.target.value})} className="w-1/2 p-3 bg-gray-100 rounded-xl font-bold text-gray-800"/>
                                    <input type="number" placeholder="Stock Initial" value={newProd.stock} onChange={e=>setNewProd({...newProd, stock: e.target.value})} className="w-1/2 p-3 bg-gray-100 rounded-xl font-bold text-gray-800"/>
                                </div>
                                <button onClick={() => {
                                    if(newProd.name && newProd.price && newProd.stock) {
                                        onNewProduct(newProd.name, parseInt(newProd.price), parseInt(newProd.stock));
                                        setNewProd({ name: '', price: '', stock: '' });
                                    } else alert("Remplissez tout !");
                                }} className="w-full bg-purple-600 text-white p-3 rounded-xl font-bold btn-press">CR√âER PRODUIT</button>
                            </div>
                        )}
                    </div>
                    <div className="space-y-2 pb-20">
                        {products.map(p => (
                            <div key={p.id} className="bg-white/10 p-3 rounded-xl flex justify-between text-white border border-white/5">
                                <span className="text-sm font-medium">{p.name}</span>
                                <span className={`font-mono font-bold px-2 rounded ${p.stock<5?'bg-red-500':'bg-white/20'}`}>{p.stock}</span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPALE ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('HOME');
            const [showStats, setShowStats] = useState(false);
            const [products, setProducts] = useState(INIT_PRODUCTS);
            const [transactions, setTransactions] = useState([]);
            
            // √âTAT DU PANIER
            const [cart, setCart] = useState([]);
            const [showCart, setShowCart] = useState(false);

            const [search, setSearch] = useState("");
            const [selectedOp, setSelectedOp] = useState(null);
            const [serviceQty, setServiceQty] = useState(1);

            useEffect(() => { lucide.createIcons(); }, [view, user, showStats, cart, products, showCart]);

            const handleLogout = () => { if(confirm("Changer d'utilisateur ?")) { setUser(null); setView('HOME'); } };
            const addTx = (cat, type, amount, desc, operator=null) => {
                setTransactions([...transactions, { id: generateId(), date: Date.now(), cat, type, amount, desc, operator, by: user.name }]);
            };

            // GESTION PANIER AVANCEE
            const addToCart = (product) => {
                const existing = cart.find(c => c.id === product.id);
                if(existing) {
                    // Si existe d√©j√†, on incr√©mente juste la quantit√©
                    updateCartItem(product.id, 'qty', existing.qty + 1);
                } else {
                    // Sinon on ajoute avec le prix catalogue par d√©faut
                    setCart([...cart, { ...product, qty: 1 }]);
                }
                // Petit effet visuel
                // alert(`${product.name} ajout√© au panier`);
            };

            const updateCartItem = (id, field, value) => {
                setCart(cart.map(c => c.id === id ? { ...c, [field]: value } : c));
            };

            const removeFromCart = (id) => {
                setCart(cart.filter(c => c.id !== id));
            };

            const validateCartSale = () => {
                const total = cart.reduce((a,c)=>a+(c.price*c.qty),0);
                if(confirm(`Valider la vente pour ${formatMoney(total)} ?`)) {
                    // Mise √† jour Stock
                    const newProducts = products.map(p => {
                        const inCart = cart.find(c => c.id === p.id);
                        return inCart ? { ...p, stock: p.stock - inCart.qty } : p;
                    });
                    setProducts(newProducts);
                    
                    // Transaction
                    addTx('SHOP', 'SALE', total, `Vente ${cart.length} articles (Modif Prix)`);
                    
                    setCart([]);
                    setShowCart(false);
                    alert("‚úÖ Vente enregistr√©e avec succ√®s !");
                }
            };

            const validateService = (s) => {
                const total = s.price * serviceQty;
                if(confirm(`Valider ${s.name} x${serviceQty} (${formatMoney(total)}) ?`)) {
                    addTx('SERVICE', 'SALE', total, `${s.name} x${serviceQty}`);
                    setServiceQty(1);
                    alert("Service OK !");
                }
            };

            const validateMoney = (type) => {
                const amount = prompt(`Montant du ${type} pour ${selectedOp.name} ?`);
                if(amount) {
                    addTx('MONEY', type === 'D√©p√¥t' ? 'DEPOSIT' : 'WITHDRAW', parseInt(amount), `${selectedOp.name} ${type}`, selectedOp.name);
                    alert("Op√©ration Enregistr√©e !");
                }
            };

            const handleAddStock = (id, qty) => {
                setProducts(products.map(p => p.id===id ? {...p, stock: p.stock+qty} : p));
                alert("Stock Mis √† jour !");
            };
            const handleNewProduct = (name, price, stock) => {
                setProducts([...products, { id: generateId(), name, price, stock }]);
                alert("Produit Cr√©√© !");
            };

            if(!user) return <Login onLogin={setUser} />;

            return (
                <div className={`min-h-screen transition-colors duration-500 ${view === 'HOME' ? 'bg-home' : view === 'SHOP' ? 'bg-shop' : view === 'SERVICES' ? 'bg-service' : view === 'MONEY' ? 'bg-money' : 'bg-stock'}`}>
                    
                    {showStats && <DashboardStats transactions={transactions} onClose={()=>setShowStats(false)} />}
                    
                    {/* LE PANIER MODAL */}
                    {showCart && (
                        <CartModal 
                            cart={cart} 
                            updateCartItem={updateCartItem} 
                            removeFromCart={removeFromCart} 
                            onCheckout={validateCartSale} 
                            onClose={()=>setShowCart(false)} 
                        />
                    )}

                    <Header 
                        title={view} 
                        user={user} 
                        onBack={view!=='HOME'?()=>setView('HOME'):null} 
                        onLogout={handleLogout} 
                        cartCount={view === 'SHOP' ? cart.reduce((a,c)=>a+c.qty,0) : undefined}
                        onOpenCart={()=>setShowCart(true)}
                    />

                    {/* ACCUEIL */}
                    {view === 'HOME' && (
                        <div className="p-6 slide-up">
                            <div className="grid grid-cols-2 gap-4 mb-8">
                                <button onClick={()=>setView('SHOP')} className="glass h-40 flex flex-col items-center justify-center gap-3 btn-press hover:bg-orange-50"><div className="w-14 h-14 bg-orange-500 rounded-full flex items-center justify-center text-white"><i data-lucide="shopping-bag"></i></div><span className="font-black">BOUTIQUE</span></button>
                                <button onClick={()=>setView('SERVICES')} className="glass h-40 flex flex-col items-center justify-center gap-3 btn-press hover:bg-blue-50"><div className="w-14 h-14 bg-blue-500 rounded-full flex items-center justify-center text-white"><i data-lucide="printer"></i></div><span className="font-black">SERVICES</span></button>
                                <button onClick={()=>setView('MONEY')} className="glass h-40 flex flex-col items-center justify-center gap-3 btn-press hover:bg-green-50"><div className="w-14 h-14 bg-green-600 rounded-full flex items-center justify-center text-white"><i data-lucide="smartphone"></i></div><span className="font-black">TRANSFERT</span></button>
                                {user.role === 'ADMIN' ? (
                                    <button onClick={()=>setView('STOCK')} className="glass h-40 flex flex-col items-center justify-center gap-3 btn-press hover:bg-purple-50"><div className="w-14 h-14 bg-purple-600 rounded-full flex items-center justify-center text-white"><i data-lucide="package"></i></div><span className="font-black">STOCK</span></button>
                                ) : (<div className="glass opacity-50 h-40 flex flex-col items-center justify-center"><i data-lucide="lock"></i></div>)}
                            </div>
                            <button onClick={()=>setShowStats(true)} className="w-full glass p-5 flex justify-between items-center btn-press shadow-xl"><div className="flex items-center gap-3"><div className="bg-gray-800 text-white p-3 rounded-full"><i data-lucide="bar-chart-2"></i></div><span className="font-black text-lg">VOIR LE BILAN</span></div><i data-lucide="chevron-right"></i></button>
                        </div>
                    )}

                    {/* BOUTIQUE */}
                    {view === 'SHOP' && (
                        <div className="p-4 pb-24 slide-up">
                            <input type="text" placeholder="Rechercher produit..." className="w-full p-4 rounded-xl glass mb-4 font-bold border-none outline-none text-gray-800" onChange={e=>setSearch(e.target.value)}/>
                            <div className="space-y-3">
                                {products.filter(p=>p.name.toLowerCase().includes(search.toLowerCase())).map(p => (
                                    <button key={p.id} onClick={()=>addToCart(p)} className="w-full glass p-3 flex justify-between items-center btn-press text-gray-800">
                                        <div className="text-left"><div className="font-bold">{p.name}</div><div className={`text-xs ${p.stock<5?'text-red-500':'text-green-600'} font-bold`}>Stock: {p.stock}</div></div>
                                        <div className="font-black text-lg">{formatMoney(p.price)}</div>
                                        <div className="bg-orange-100 p-2 rounded-full text-orange-600"><i data-lucide="plus"></i></div>
                                    </button>
                                ))}
                            </div>
                            
                            {/* BOUTON FLOTTANT VOIR PANIER */}
                            {cart.length > 0 && (
                                <button onClick={()=>setShowCart(true)} className="fixed bottom-6 left-6 right-6 bg-orange-600 text-white p-4 rounded-2xl font-black text-lg shadow-2xl btn-press flex justify-between items-center z-40 border-2 border-orange-400">
                                    <span className="bg-white text-orange-600 px-3 py-1 rounded-full">{cart.reduce((a,c)=>a+c.qty,0)} art.</span>
                                    <span>VOIR PANIER ({formatMoney(cart.reduce((a,c)=>a+(c.price*c.qty),0))})</span>
                                    <i data-lucide="shopping-cart"></i>
                                </button>
                            )}
                        </div>
                    )}

                    {view === 'SERVICES' && (
                        <div className="p-4 grid grid-cols-2 gap-4 slide-up">
                            <div className="col-span-2 glass p-4 flex justify-between items-center mb-2">
                                <span className="font-bold">Quantit√© :</span>
                                <div className="flex gap-4 items-center"><button onClick={()=>setServiceQty(Math.max(1,serviceQty-1))} className="w-10 h-10 bg-gray-200 rounded-full font-bold text-xl">-</button><span className="text-2xl font-black">{serviceQty}</span><button onClick={()=>setServiceQty(serviceQty+1)} className="w-10 h-10 bg-gray-200 rounded-full font-bold text-xl">+</button></div>
                            </div>
                            {INIT_SERVICES.map(s => (
                                <button key={s.id} onClick={()=>validateService(s)} className="glass p-4 flex flex-col items-center gap-2 btn-press"><i data-lucide={s.icon} className="text-blue-600 w-8 h-8"></i><span className="font-bold text-center leading-tight">{s.name}</span><span className="text-blue-600 font-bold">{formatMoney(s.price)}</span></button>
                            ))}
                        </div>
                    )}

                    {view === 'MONEY' && (
                        <div className="p-4 slide-up">
                            {!selectedOp ? (
                                <div className="grid grid-cols-2 gap-4">
                                    {OPERATORS.map(op => (
                                        <button key={op.name} onClick={()=>setSelectedOp(op)} className={`${op.color} h-32 rounded-2xl flex flex-col items-center justify-center gap-2 shadow-lg btn-press`}><span className="font-black text-lg uppercase text-center text-white">{op.name}</span></button>
                                    ))}
                                </div>
                            ) : (
                                <div className="glass p-6 text-center animate-fade-in">
                                    <h2 className={`text-2xl font-black uppercase mb-6 p-4 rounded-xl text-white ${selectedOp.color}`}>{selectedOp.name}</h2>
                                    <div className="grid grid-cols-2 gap-4">
                                        <button onClick={()=>validateMoney('D√©p√¥t')} className="bg-green-600 text-white p-6 rounded-2xl font-black btn-press text-lg">D√âP√îT<br/><span className="text-xs font-normal opacity-80">(Client donne)</span></button>
                                        <button onClick={()=>validateMoney('Retrait')} className="bg-red-600 text-white p-6 rounded-2xl font-black btn-press text-lg">RETRAIT<br/><span className="text-xs font-normal opacity-80">(Client re√ßoit)</span></button>
                                    </div>
                                    <button onClick={()=>setSelectedOp(null)} className="mt-8 text-gray-500 font-bold underline">Changer d'op√©rateur</button>
                                </div>
                            )}
                        </div>
                    )}

                    {view === 'STOCK' && <AdminStock products={products} onAddStock={handleAddStock} onNewProduct={handleNewProduct} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
