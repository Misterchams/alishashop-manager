<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ALISHASHOP Manager V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background: #F3F4F6; -webkit-tap-highlight-color: transparent; }
        
        /* Design Am√©lior√© inspir√© du code source mais modernis√© */
        .gradient-orange { background: linear-gradient(135deg, #FF6B35 0%, #FF1493 100%); } /* Ton orange d'origine */
        .gradient-blue { background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); } /* Finance */
        .gradient-green { background: linear-gradient(135deg, #10B981 0%, #059669 100%); } /* Validation */
        .gradient-purple { background: linear-gradient(135deg, #8B5CF6 0%, #6D28D9 100%); } /* Admin/Stock */
        
        .card { background: white; border-radius: 20px; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
        .btn-press:active { transform: scale(0.96); transition: 0.1s; }
        .input-box { width: 100%; background: #F9FAFB; border: 2px solid #E5E7EB; border-radius: 12px; padding: 12px; font-weight: bold; font-size: 1.1rem; outline: none; transition: 0.2s; }
        .input-box:focus { border-color: #FF6B35; background: white; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- OUTILS ---
        const generateId = () => Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
        const formatMoney = (n) => new Intl.NumberFormat('fr-FR').format(n) + ' FCFA';
        const formatDate = () => new Date().toLocaleDateString('fr-FR', { weekday: 'short', day: 'numeric', month: 'short' });

        // --- DONN√âES DE BASE (Inspir√©es de la source) ---
        const INITIAL_SERVICES = [
            { id: 'S1', name: 'Photocopie N&B', price: 50, category: 'repro' },
            { id: 'S2', name: 'Photocopie Couleur', price: 100, category: 'repro' },
            { id: 'S3', name: 'Impression', price: 100, category: 'repro' },
            { id: 'S4', name: 'Plastification', price: 500, category: 'repro' },
            { id: 'S5', name: 'Reliure', price: 1000, category: 'repro' },
            { id: 'S6', name: 'Scanner', price: 200, category: 'repro' },
            { id: 'S7', name: 'Photo Identit√©', price: 2000, category: 'photo' },
            { id: 'S99', name: 'Autre Service', price: 0, category: 'autre' }
        ];

        const OPERATORS = ['Wave', 'Orange Money', 'Free Money', 'Wizall'];

        // --- COMPOSANT LOGIN (Gard√© simple) ---
        const Login = ({ onLogin }) => {
            const [pin, setPin] = useState("");
            const users = [
                { id: 'U1', name: 'Patron', role: 'admin', pin: '1234' },
                { id: 'U2', name: 'Vendeur', role: 'staff', pin: '0000' }
            ];

            useEffect(() => {
                if (pin.length === 4) {
                    const u = users.find(user => user.pin === pin);
                    if (u) onLogin(u);
                    else { alert("Code Erron√©"); setPin(""); }
                }
            }, [pin]);

            return (
                <div className="min-h-screen gradient-orange flex flex-col items-center justify-center p-6 text-white">
                    <div className="w-20 h-20 bg-white/20 rounded-3xl flex items-center justify-center mb-4 backdrop-blur-sm">
                        <i data-lucide="store" className="w-10 h-10 text-white"></i>
                    </div>
                    <h1 className="text-3xl font-black mb-1">ALISHASHOP</h1>
                    <p className="opacity-80 mb-8 font-medium">Gestion Multiservices</p>
                    
                    <div className="flex gap-3 mb-8">
                        {[0,1,2,3].map(i => (
                            <div key={i} className={`w-4 h-4 rounded-full transition-all ${pin.length > i ? 'bg-white scale-125' : 'bg-white/30'}`}></div>
                        ))}
                    </div>

                    <div className="grid grid-cols-3 gap-4 w-full max-w-xs">
                        {[1,2,3,4,5,6,7,8,9].map(n => (
                            <button key={n} onClick={() => setPin(p => p + n)} className="h-20 bg-white/10 rounded-2xl text-2xl font-bold backdrop-blur-sm active:bg-white/30 transition">
                                {n}
                            </button>
                        ))}
                        <div className="col-start-2">
                            <button onClick={() => setPin(p => p + '0')} className="w-full h-20 bg-white/10 rounded-2xl text-2xl font-bold backdrop-blur-sm active:bg-white/30">0</button>
                        </div>
                        <button onClick={() => setPin(p => p.slice(0, -1))} className="h-20 bg-red-500/20 rounded-2xl flex items-center justify-center backdrop-blur-sm active:bg-red-500/40">
                            <i data-lucide="delete" className="w-8 h-8"></i>
                        </button>
                    </div>
                </div>
            );
        };

        // --- MODULE VENTE BOUTIQUE ---
        const ShopModule = ({ products, onAddTransaction, onUpdateStock }) => {
            const [cart, setCart] = useState([]);
            const [searchTerm, setSearchTerm] = useState("");
            const [showScanner, setShowScanner] = useState(false);

            const addToCart = (p) => {
                if (p.stock <= 0) return alert("Stock √©puis√© !");
                const existing = cart.find(c => c.id === p.id);
                if (existing) {
                    if (existing.qty < p.stock) setCart(cart.map(c => c.id === p.id ? { ...c, qty: c.qty + 1 } : c));
                } else {
                    setCart([...cart, { ...p, qty: 1 }]);
                }
            };

            const confirmSale = () => {
                const total = cart.reduce((acc, item) => acc + (item.price * item.qty), 0);
                if (confirm(`Valider la vente de ${formatMoney(total)} ?`)) {
                    // 1. Mettre √† jour le stock
                    cart.forEach(item => onUpdateStock(item.id, -item.qty)); // -qty pour d√©duire
                    // 2. Enregistrer la transaction
                    onAddTransaction({
                        type: 'SALE',
                        category: 'BOUTIQUE',
                        amount: total,
                        desc: `Vente ${cart.length} articles`,
                        details: cart.map(c => `${c.name} (x${c.qty})`).join(', ')
                    });
                    setCart([]);
                }
            };

            // Filtrer les produits
            const visibleProducts = products.filter(p => p.name.toLowerCase().includes(searchTerm.toLowerCase()));

            return (
                <div className="flex flex-col h-full">
                    {/* Barre de recherche */}
                    <div className="bg-white p-4 sticky top-0 z-10 shadow-sm flex gap-2">
                        <div className="relative flex-1">
                            <i data-lucide="search" className="absolute left-3 top-3.5 text-gray-400 w-5 h-5"></i>
                            <input 
                                type="text" 
                                placeholder="Chercher produit..." 
                                className="input-box pl-10"
                                value={searchTerm}
                                onChange={e => setSearchTerm(e.target.value)}
                            />
                        </div>
                        {/* Scanner (Simulation bouton) */}
                        <button className="bg-gray-800 text-white p-3 rounded-xl" onClick={()=>alert("Fonction Scanner active (camera)")}>
                            <i data-lucide="scan-barcode"></i>
                        </button>
                    </div>

                    {/* Grille Produits */}
                    <div className="p-4 grid grid-cols-2 gap-3 pb-24 overflow-y-auto">
                        {visibleProducts.map(p => (
                            <button key={p.id} onClick={() => addToCart(p)} className="bg-white p-3 rounded-2xl shadow-sm text-left btn-press border border-gray-100 relative overflow-hidden">
                                {p.stock <= 0 && <div className="absolute inset-0 bg-white/60 flex items-center justify-center font-bold text-red-500 rotate-12 border-2 border-red-500 rounded-xl m-2">√âPUIS√â</div>}
                                <div className="h-10 w-10 bg-orange-100 rounded-full flex items-center justify-center mb-2 text-orange-600">
                                    <i data-lucide="shopping-bag" className="w-5 h-5"></i>
                                </div>
                                <h3 className="font-bold text-gray-800 text-sm leading-tight mb-1 truncate">{p.name}</h3>
                                <div className="flex justify-between items-end">
                                    <span className="font-black text-orange-600">{formatMoney(p.price)}</span>
                                    <span className={`text-xs font-bold px-1.5 py-0.5 rounded ${p.stock < 5 ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'}`}>{p.stock}</span>
                                </div>
                            </button>
                        ))}
                    </div>

                    {/* Panier Flottant */}
                    {cart.length > 0 && (
                        <div className="fixed bottom-20 left-4 right-4 bg-gray-900 text-white p-4 rounded-2xl shadow-2xl z-20 flex justify-between items-center" onClick={confirmSale}>
                            <div className="flex items-center gap-3">
                                <div className="bg-orange-500 w-10 h-10 rounded-full flex items-center justify-center font-bold">
                                    {cart.reduce((a, c) => a + c.qty, 0)}
                                </div>
                                <div>
                                    <p className="text-xs text-gray-400">Total √† payer</p>
                                    <p className="font-bold text-xl">{formatMoney(cart.reduce((a, c) => a + (c.price * c.qty), 0))}</p>
                                </div>
                            </div>
                            <span className="font-bold text-orange-400 flex items-center gap-1">ENCAISSER <i data-lucide="arrow-right" className="w-5 h-5"></i></span>
                        </div>
                    )}
                </div>
            );
        };

        // --- MODULE SERVICES (REPROGRAPHIE) AVEC QUANTIT√â ---
        const ServicesModule = ({ onAddTransaction, isAdmin }) => {
            const [selectedService, setSelectedService] = useState(null);
            const [qty, setQty] = useState(1);
            const [customPrice, setCustomPrice] = useState("");

            const handleSelect = (s) => {
                setSelectedService(s);
                setQty(1);
                setCustomPrice(s.price);
            };

            const validateService = () => {
                if (!selectedService) return;
                const finalPrice = selectedService.price === 0 ? parseInt(customPrice) : selectedService.price;
                const total = finalPrice * qty;

                if (confirm(`Confirmer : ${selectedService.name} (x${qty}) pour ${formatMoney(total)} ?`)) {
                    onAddTransaction({
                        type: 'SALE', // Consid√©r√© comme une vente
                        category: 'SERVICE',
                        amount: total,
                        desc: `${selectedService.name}`,
                        details: `Quantit√©: ${qty}`
                    });
                    setSelectedService(null);
                }
            };

            return (
                <div className="p-4 h-full flex flex-col">
                    <h2 className="text-2xl font-black text-gray-800 mb-4 px-2">Reprographie & Services</h2>
                    
                    {/* Liste des Services */}
                    <div className="grid grid-cols-2 gap-3 mb-6 overflow-y-auto flex-1">
                        {INITIAL_SERVICES.map(s => (
                            <button key={s.id} onClick={() => handleSelect(s)} 
                                className={`p-4 rounded-2xl border text-left btn-press transition shadow-sm
                                ${selectedService?.id === s.id ? 'border-blue-500 bg-blue-50 ring-2 ring-blue-200' : 'border-gray-200 bg-white'}`}>
                                <i data-lucide={s.category === 'photo' ? 'camera' : s.category === 'autre' ? 'edit-3' : 'printer'} 
                                   className={`w-8 h-8 mb-2 ${selectedService?.id === s.id ? 'text-blue-600' : 'text-gray-400'}`}></i>
                                <div className="font-bold text-gray-800 leading-tight">{s.name}</div>
                                <div className="text-sm font-semibold text-blue-600 mt-1">{s.price === 0 ? 'Sur devis' : formatMoney(s.price)}</div>
                            </button>
                        ))}
                    </div>

                    {/* Panneau de configuration Quantit√©/Prix (Appara√Æt si s√©lection) */}
                    {selectedService && (
                        <div className="bg-white rounded-t-3xl shadow-[0_-10px_40px_rgba(0,0,0,0.1)] p-6 fixed bottom-[80px] left-0 right-0 animate-slide-up z-20">
                            <div className="flex justify-between items-start mb-4">
                                <div>
                                    <h3 className="font-black text-lg">{selectedService.name}</h3>
                                    <p className="text-gray-500 text-sm">Ajustez la quantit√©</p>
                                </div>
                                <button onClick={() => setSelectedService(null)} className="bg-gray-100 p-2 rounded-full"><i data-lucide="x"></i></button>
                            </div>

                            <div className="flex gap-4 mb-4">
                                {/* Selecteur Quantit√© */}
                                <div className="flex items-center bg-gray-100 rounded-2xl p-2 w-1/2 justify-between">
                                    <button onClick={() => setQty(Math.max(1, qty - 1))} className="w-10 h-10 bg-white rounded-xl shadow font-bold text-xl">-</button>
                                    <span className="text-2xl font-black">{qty}</span>
                                    <button onClick={() => setQty(qty + 1)} className="w-10 h-10 bg-white rounded-xl shadow font-bold text-xl">+</button>
                                </div>

                                {/* Prix (si service libre) */}
                                {selectedService.price === 0 ? (
                                    <input 
                                        type="number" 
                                        placeholder="Prix Unitaire" 
                                        className="w-1/2 bg-gray-100 rounded-2xl p-4 font-bold text-center outline-none border-2 border-blue-200 focus:border-blue-500"
                                        value={customPrice}
                                        onChange={(e) => setCustomPrice(e.target.value)}
                                    />
                                ) : (
                                    <div className="w-1/2 flex flex-col justify-center items-end pr-2">
                                        <span className="text-xs text-gray-500 font-bold">TOTAL</span>
                                        <span className="text-2xl font-black text-blue-600">{formatMoney(selectedService.price * qty)}</span>
                                    </div>
                                )}
                            </div>

                            <button onClick={validateService} className="w-full py-4 gradient-blue text-white rounded-2xl font-bold text-lg shadow-lg shadow-blue-200 btn-press">
                                VALIDER SERVICE
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        // --- MODULE FINANCE (MOBILE MONEY) ---
        const FinanceModule = ({ onAddTransaction }) => {
            const [operator, setOperator] = useState(null);
            const [type, setType] = useState('DEPOSIT'); // DEPOSIT (D√©p√¥t) ou WITHDRAW (Retrait)
            const [amount, setAmount] = useState("");

            const handleSubmit = () => {
                if (!operator || !amount) return alert("Remplissez tout !");
                const val = parseInt(amount);
                
                if (confirm(`${type === 'DEPOSIT' ? 'D√âP√îT' : 'RETRAIT'} ${operator} de ${formatMoney(val)} ?`)) {
                    onAddTransaction({
                        type: 'FINANCE',
                        category: type, // 'DEPOSIT' (Entr√©e Client = Sortie Caisse) ou 'WITHDRAW' (Sortie Client = Entr√©e Caisse)
                        // ATTENTION LOGIQUE CAISSE :
                        // Un D√©p√¥t client = Le client donne du cash (Caisse augmente) -> On envoie du virtuel.
                        // Un Retrait client = Le client envoie du virtuel -> On donne du cash (Caisse diminue).
                        // On va simplifier : On note le flux.
                        operator: operator,
                        amount: val,
                        desc: `${operator} - ${type === 'DEPOSIT' ? 'D√©p√¥t' : 'Retrait'}`
                    });
                    setAmount("");
                    setOperator(null);
                }
            };

            return (
                <div className="p-4">
                    <h2 className="text-2xl font-black text-gray-800 mb-6">Mobile Money</h2>
                    
                    {/* Choix Op√©rateur */}
                    <div className="grid grid-cols-2 gap-3 mb-6">
                        {OPERATORS.map(op => (
                            <button key={op} onClick={() => setOperator(op)}
                                className={`p-4 rounded-2xl font-bold border-2 transition btn-press
                                ${operator === op ? 'border-blue-500 bg-blue-50 text-blue-700' : 'border-transparent bg-white text-gray-600 shadow-sm'}`}>
                                {op}
                            </button>
                        ))}
                    </div>

                    {operator && (
                        <div className="animate-slide-up bg-white p-6 rounded-3xl shadow-lg border border-gray-100">
                            <div className="flex bg-gray-100 p-1 rounded-xl mb-6">
                                <button onClick={() => setType('DEPOSIT')} className={`flex-1 py-3 rounded-lg font-bold text-sm transition ${type === 'DEPOSIT' ? 'bg-green-500 text-white shadow' : 'text-gray-500'}`}>
                                    D√âP√îT (Client verse)
                                </button>
                                <button onClick={() => setType('WITHDRAW')} className={`flex-1 py-3 rounded-lg font-bold text-sm transition ${type === 'WITHDRAW' ? 'bg-red-500 text-white shadow' : 'text-gray-500'}`}>
                                    RETRAIT (Client re√ßoit)
                                </button>
                            </div>

                            <div className="mb-6">
                                <label className="text-xs font-bold text-gray-500 ml-2">MONTANT</label>
                                <input type="number" value={amount} onChange={e => setAmount(e.target.value)}
                                    className="w-full text-3xl font-black p-4 bg-gray-50 rounded-2xl outline-none border-2 border-transparent focus:border-blue-500 focus:bg-white transition"
                                    placeholder="0" />
                            </div>

                            <button onClick={handleSubmit} className={`w-full py-4 rounded-2xl font-bold text-white text-lg shadow-lg btn-press ${type === 'DEPOSIT' ? 'gradient-green' : 'gradient-orange'}`}>
                                VALIDER OP√âRATION
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        // --- MODULE STOCK (INCR√âMENTATION FACTURE) ---
        const StockModule = ({ products, onUpdateStock, onAddProduct }) => {
            const [mode, setMode] = useState('list'); // 'list' ou 'entry'
            const [selectedId, setSelectedId] = useState("");
            const [qtyToAdd, setQtyToAdd] = useState("");
            const [newPrice, setNewPrice] = useState("");

            const handleRestock = () => {
                if(!selectedId || !qtyToAdd) return;
                onUpdateStock(selectedId, parseInt(qtyToAdd), newPrice ? parseInt(newPrice) : null);
                alert("Stock mis √† jour avec succ√®s !");
                setQtyToAdd("");
                setNewPrice("");
            };

            const handleCreate = () => {
                const name = prompt("Nom du nouveau produit ?");
                if(name) {
                    const price = prompt("Prix de vente ?");
                    const stock = prompt("Stock initial (Facture) ?");
                    const newProd = { id: generateId(), name, price: parseInt(price), stock: parseInt(stock) };
                    onAddProduct(newProd);
                    alert("Produit cr√©√© !");
                }
            };

            return (
                <div className="p-4 pb-24">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-black text-gray-800">Gestion Stock</h2>
                        <button onClick={handleCreate} className="bg-gray-900 text-white px-4 py-2 rounded-lg font-bold text-sm">+ Nouveau</button>
                    </div>

                    {/* Zone Saisie Facture */}
                    <div className="bg-white p-6 rounded-3xl shadow-lg border-2 border-purple-100 mb-8">
                        <h3 className="font-bold text-purple-700 mb-4 flex items-center gap-2"><i data-lucide="file-plus"></i> SAISIE FACTURE</h3>
                        
                        <div className="space-y-4">
                            <div>
                                <label className="text-xs font-bold text-gray-400">PRODUIT</label>
                                <select className="input-box" value={selectedId} onChange={e => setSelectedId(e.target.value)}>
                                    <option value="">-- S√©lectionner produit --</option>
                                    {products.map(p => <option key={p.id} value={p.id}>{p.name} (Actuel: {p.stock})</option>)}
                                </select>
                            </div>
                            <div className="flex gap-3">
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-gray-400">QUANTIT√â (+)</label>
                                    <input type="number" className="input-box" placeholder="Ex: 10" value={qtyToAdd} onChange={e=>setQtyToAdd(e.target.value)} />
                                </div>
                                <div className="flex-1">
                                    <label className="text-xs font-bold text-gray-400">PRIX VENTE</label>
                                    <input type="number" className="input-box" placeholder="Optionnel" value={newPrice} onChange={e=>setNewPrice(e.target.value)} />
                                </div>
                            </div>
                            <button onClick={handleRestock} className="w-full py-3 gradient-purple text-white rounded-xl font-bold shadow-lg btn-press">
                                AJOUTER AU STOCK
                            </button>
                        </div>
                    </div>

                    {/* Liste Simple */}
                    <div className="space-y-2">
                        {products.map(p => (
                            <div key={p.id} className="bg-white p-3 rounded-xl flex justify-between items-center border border-gray-100">
                                <span className="font-bold text-gray-700">{p.name}</span>
                                <span className="bg-gray-100 px-3 py-1 rounded-lg font-bold text-sm">Stock: {p.stock}</span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPALE ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('shop'); // shop, services, finance, stock, reports
            
            // DONN√âES (Stockage Local)
            const [products, setProducts] = useState(() => JSON.parse(localStorage.getItem('alisha_products')) || [
                {id: 'p1', name: 'Ecouteurs BT', price: 3500, stock: 10},
                {id: 'p2', name: 'Cable USB-C', price: 1500, stock: 20}
            ]);
            const [transactions, setTransactions] = useState(() => JSON.parse(localStorage.getItem('alisha_transactions')) || []);

            useEffect(() => {
                localStorage.setItem('alisha_products', JSON.stringify(products));
                localStorage.setItem('alisha_transactions', JSON.stringify(transactions));
                lucide.createIcons();
            }, [products, transactions, view, user]);

            const addTransaction = (tx) => {
                setTransactions([{ id: generateId(), date: Date.now(), user: user.name, ...tx }, ...transactions]);
            };

            const updateStock = (id, qtyChange, newPrice) => {
                setProducts(products.map(p => {
                    if (p.id === id) {
                        return { 
                            ...p, 
                            stock: p.stock + qtyChange, 
                            price: newPrice || p.price 
                        };
                    }
                    return p;
                }));
            };

            const addNewProduct = (prod) => setProducts([...products, prod]);

            // G√âN√âRATEUR RAPPORT WHATSAPP COMPLET
            const sendReport = () => {
                const today = new Date().toLocaleDateString();
                const dailyTx = transactions.filter(t => new Date(t.date).toLocaleDateString() === today);
                
                // Calculs
                const sales = dailyTx.filter(t => t.type === 'SALE' && t.category === 'BOUTIQUE').reduce((a,t)=>a+t.amount,0);
                const services = dailyTx.filter(t => t.type === 'SALE' && t.category === 'SERVICE').reduce((a,t)=>a+t.amount,0);
                
                // Finance
                const depots = dailyTx.filter(t => t.type === 'FINANCE' && t.category === 'DEPOSIT');
                const retraits = dailyTx.filter(t => t.type === 'FINANCE' && t.category === 'WITHDRAW');
                const totalDepot = depots.reduce((a,t)=>a+t.amount,0);
                const totalRetrait = retraits.reduce((a,t)=>a+t.amount,0);

                const msg = `
*üìä RAPPORT ALISHASHOP - ${today}*
üë§ Vendeur: ${user.name}

*üõí VENTES & SERVICES*
-----------------------
üõçÔ∏è Boutique : ${formatMoney(sales)}
üñ®Ô∏è Services : ${formatMoney(services)}
*‚úÖ TOTAL REVENU : ${formatMoney(sales + services)}*

*üì± MOBILE MONEY (Flux)*
-----------------------
üì• D√©p√¥ts (Entr√©e Client) : ${formatMoney(totalDepot)}
üì§ Retraits (Sortie Client) : ${formatMoney(totalRetrait)}
üîÑ Balance Ops : ${depots.length} d√©p√¥ts / ${retraits.length} retraits

*üìù Commentaire :*
R.A.S
`.trim();
                window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
            };

            if (!user) return <Login onLogin={setUser} />;

            return (
                <div className="max-w-md mx-auto min-h-screen bg-gray-50 flex flex-col shadow-2xl relative">
                    {/* Header */}
                    <div className="bg-white p-4 shadow-sm flex justify-between items-center z-10">
                        <div>
                            <h1 className="font-black text-xl tracking-tight gradient-orange text-transparent bg-clip-text">ALISHASHOP</h1>
                            <p className="text-xs font-bold text-gray-400 uppercase tracking-wider">{user.role === 'admin' ? 'Espace G√©rant' : `Vendeur: ${user.name}`}</p>
                        </div>
                        {user.role === 'admin' && (
                            <div className="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-bold">Admin</div>
                        )}
                    </div>

                    {/* Contenu */}
                    <div className="flex-1 overflow-hidden relative">
                        {view === 'shop' && <ShopModule products={products} onAddTransaction={addTransaction} onUpdateStock={updateStock} />}
                        {view === 'services' && <ServicesModule onAddTransaction={addTransaction} isAdmin={user.role==='admin'} />}
                        {view === 'finance' && <FinanceModule onAddTransaction={addTransaction} />}
                        {view === 'stock' && (user.role==='admin' ? <StockModule products={products} onUpdateStock={updateStock} onAddProduct={addNewProduct} /> : <div className="p-10 text-center text-gray-400">Acc√®s R√©serv√©</div>)}
                        
                        {view === 'reports' && (
                            <div className="p-6 h-full overflow-y-auto pb-24">
                                <h2 className="text-2xl font-black mb-6 text-gray-800">Bilan du Jour</h2>
                                
                                <div className="grid grid-cols-2 gap-4 mb-6">
                                    <div className="bg-white p-4 rounded-2xl shadow-sm border border-orange-100">
                                        <p className="text-xs font-bold text-gray-400">VENTE TOTAL</p>
                                        <p className="text-xl font-black text-orange-600">
                                            {formatMoney(transactions.filter(t=>t.type==='SALE' && new Date(t.date).toLocaleDateString() === new Date().toLocaleDateString()).reduce((a,t)=>a+t.amount,0))}
                                        </p>
                                    </div>
                                    <div className="bg-white p-4 rounded-2xl shadow-sm border border-blue-100">
                                        <p className="text-xs font-bold text-gray-400">OPERATIONS MM</p>
                                        <p className="text-xl font-black text-blue-600">
                                            {transactions.filter(t=>t.type==='FINANCE' && new Date(t.date).toLocaleDateString() === new Date().toLocaleDateString()).length}
                                        </p>
                                    </div>
                                </div>

                                <button onClick={sendReport} className="w-full py-4 gradient-green text-white font-bold rounded-2xl shadow-lg shadow-green-200 btn-press flex items-center justify-center gap-2 mb-8">
                                    <i data-lucide="message-circle"></i> ENVOYER RAPPORT WHATSAPP
                                </button>

                                <h3 className="font-bold text-gray-500 mb-3 text-sm uppercase">Derni√®res op√©rations</h3>
                                <div className="space-y-3">
                                    {transactions.slice(0,10).map(t => (
                                        <div key={t.id} className="bg-white p-3 rounded-xl flex items-center gap-3 shadow-sm">
                                            <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white
                                                ${t.category === 'BOUTIQUE' ? 'bg-orange-500' : t.category === 'SERVICE' ? 'bg-blue-500' : 'bg-gray-800'}`}>
                                                <i data-lucide={t.category === 'BOUTIQUE' ? 'shopping-bag' : t.category === 'SERVICE' ? 'printer' : 'smartphone'}></i>
                                            </div>
                                            <div className="flex-1">
                                                <p className="font-bold text-sm text-gray-800">{t.desc}</p>
                                                {t.details && <p className="text-xs text-gray-500">{t.details}</p>}
                                            </div>
                                            <p className="font-black text-sm">{formatMoney(t.amount)}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Navigation Bas */}
                    <div className="bg-white p-2 border-t flex justify-around pb-safe">
                        <button onClick={() => setView('shop')} className={`p-2 rounded-xl flex flex-col items-center gap-1 w-16 transition ${view==='shop' ? 'text-orange-600 bg-orange-50' : 'text-gray-400'}`}>
                            <i data-lucide="shopping-cart"></i>
                            <span className="text-[10px] font-bold">Vente</span>
                        </button>
                        <button onClick={() => setView('services')} className={`p-2 rounded-xl flex flex-col items-center gap-1 w-16 transition ${view==='services' ? 'text-blue-600 bg-blue-50' : 'text-gray-400'}`}>
                            <i data-lucide="printer"></i>
                            <span className="text-[10px] font-bold">Serv.</span>
                        </button>
                        <button onClick={() => setView('finance')} className={`p-2 rounded-xl flex flex-col items-center gap-1 w-16 transition ${view==='finance' ? 'text-gray-800 bg-gray-100' : 'text-gray-400'}`}>
                            <i data-lucide="smartphone"></i>
                            <span className="text-[10px] font-bold">Money</span>
                        </button>
                        <button onClick={() => setView('stock')} className={`p-2 rounded-xl flex flex-col items-center gap-1 w-16 transition ${view==='stock' ? 'text-purple-600 bg-purple-50' : 'text-gray-400'}`}>
                            <i data-lucide="package"></i>
                            <span className="text-[10px] font-bold">Stock</span>
                        </button>
                        <button onClick={() => setView('reports')} className={`p-2 rounded-xl flex flex-col items-center gap-1 w-16 transition ${view==='reports' ? 'text-green-600 bg-green-50' : 'text-gray-400'}`}>
                            <i data-lucide="file-text"></i>
                            <span className="text-[10px] font-bold">Bilan</span>
                        </button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
