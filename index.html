<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ALISHASHOP Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* Thèmes */
        .theme-orange { --primary: #FF6B35; --secondary: #FF1493; --bg: #FFF7ED; --text: #1f2937; }
        .theme-blue { --primary: #2563EB; --secondary: #06B6D4; --bg: #EFF6FF; --text: #1f2937; }
        .theme-dark { --primary: #F59E0B; --secondary: #D97706; --bg: #111827; --text: #F3F4F6; }
        
        .app-container { background-color: var(--bg); color: var(--text); min-height: 100vh; transition: 0.3s; }
        .btn-primary { background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: white; }
        .text-primary { color: var(--primary); }
        .border-primary { border-color: var(--primary); }
        
        .card { background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); border-radius: 20px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .theme-dark .card { background: rgba(31, 41, 55, 0.8); border: 1px solid rgba(255,255,255,0.1); }
        
        .btn-press:active { transform: scale(0.96); }
        .animate-slide { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- OUTILS & DONNÉES CONCRÈTES ---
        const formatMoney = (n) => new Intl.NumberFormat('fr-FR').format(n) + ' FCFA';
        const generateId = () => Math.random().toString(36).substr(2, 5);
        
        // Exemples Concrets (Produits)
        const SAMPLE_PRODUCTS = [
            { id: 'P1', name: 'Clé USB SanDisk 32Go', price: 4500, stock: 12 },
            { id: 'P2', name: 'Câble iPhone Rapide', price: 2500, stock: 20 },
            { id: 'P3', name: 'Ecouteurs Samsung AKG', price: 3000, stock: 8 },
            { id: 'P4', name: 'Rame Papier A4 Double A', price: 4000, stock: 5 },
            { id: 'P5', name: 'Stylo Bleu BIC', price: 100, stock: 50 }
        ];

        // Exemples Concrets (Services)
        const SAMPLE_SERVICES = [
            { id: 'S1', name: 'Photocopie N&B', price: 50, icon: 'files' },
            { id: 'S2', name: 'Photocopie Couleur', price: 100, icon: 'palette' },
            { id: 'S3', name: 'Reliure Spirale GM', price: 1000, icon: 'book' },
            { id: 'S4', name: 'Scanner Document', price: 200, icon: 'scan' },
            { id: 'S5', name: 'Photo Identité (Plan)', price: 2000, icon: 'camera' },
            { id: 'S6', name: 'Plastification A4', price: 500, icon: 'layers' }
        ];

        // --- COMPOSANT : HEADER (Avec Retour & Thème) ---
        const Header = ({ title, user, view, onBack, currentTheme, onToggleTheme }) => (
            <div className="p-4 sticky top-0 z-20 bg-white/80 backdrop-blur-md shadow-sm flex items-center justify-between">
                <div className="flex items-center gap-3">
                    {view !== 'dashboard' && (
                        <button onClick={onBack} className="p-2 bg-gray-100 rounded-full hover:bg-gray-200 btn-press">
                            <i data-lucide="arrow-left" className="w-5 h-5 text-gray-700"></i>
                        </button>
                    )}
                    <div>
                        <h1 className="font-black text-lg text-primary leading-none">{title}</h1>
                        <p className="text-[10px] font-bold opacity-60 uppercase">{user ? user.role : 'Manager'}</p>
                    </div>
                </div>
                <button onClick={onToggleTheme} className="p-2 rounded-full bg-gray-100 btn-press">
                    <i data-lucide={currentTheme === 'theme-dark' ? 'sun' : 'moon'} className="w-5 h-5 text-gray-700"></i>
                </button>
            </div>
        );

        // --- MODULE : VENTE BOUTIQUE ---
        const ShopModule = ({ products, onSale }) => {
            const [cart, setCart] = useState([]);
            const [search, setSearch] = useState("");

            const addToCart = (p) => {
                if(p.stock <= 0) return alert("Stock épuisé !");
                const existing = cart.find(c => c.id === p.id);
                if(existing) {
                    if(existing.qty < p.stock) setCart(cart.map(c => c.id === p.id ? {...c, qty: c.qty+1} : c));
                } else setCart([...cart, {...p, qty: 1}]);
            };

            const filtered = products.filter(p => p.name.toLowerCase().includes(search.toLowerCase()));

            return (
                <div className="p-4 pb-24 animate-slide">
                    <div className="relative mb-4">
                        <i data-lucide="search" className="absolute left-3 top-3 text-gray-400 w-5 h-5"></i>
                        <input type="text" placeholder="Chercher un article..." value={search} onChange={e=>setSearch(e.target.value)}
                            className="w-full pl-10 p-3 rounded-xl bg-gray-100 border-none outline-none font-bold" />
                    </div>
                    
                    <div className="grid grid-cols-1 gap-3">
                        {filtered.map(p => (
                            <div key={p.id} onClick={()=>addToCart(p)} className="card p-3 flex justify-between items-center btn-press">
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center">
                                        <i data-lucide="shopping-bag" className="w-5 h-5"></i>
                                    </div>
                                    <div>
                                        <h3 className="font-bold text-sm">{p.name}</h3>
                                        <p className="text-xs opacity-60">En stock: {p.stock}</p>
                                    </div>
                                </div>
                                <span className="font-black text-primary">{formatMoney(p.price)}</span>
                            </div>
                        ))}
                    </div>

                    {cart.length > 0 && (
                        <button onClick={()=>onSale(cart, setCart)} className="fixed bottom-20 left-4 right-4 btn-primary p-4 rounded-2xl font-bold shadow-xl flex justify-between items-center z-30 btn-press">
                            <span className="bg-white text-black w-8 h-8 rounded-full flex items-center justify-center">{cart.reduce((a,c)=>a+c.qty,0)}</span>
                            <span>ENCAISSER {formatMoney(cart.reduce((a,c)=>a+(c.price*c.qty),0))}</span>
                            <i data-lucide="check-circle"></i>
                        </button>
                    )}
                </div>
            );
        };

        // --- MODULE : SERVICES (REPROGRAPHIE) ---
        const ServicesModule = ({ onServiceSale }) => {
            const [selected, setSelected] = useState(null);
            const [qty, setQty] = useState(1);
            const [customPrice, setCustomPrice] = useState("");

            const handleSelect = (s) => { setSelected(s); setQty(1); setCustomPrice(s.price); };

            const validate = () => {
                const finalPrice = selected.price === 0 ? parseInt(customPrice || 0) : selected.price;
                onServiceSale(selected.name, qty, finalPrice * qty);
                setSelected(null);
            };

            return (
                <div className="p-4 pb-24 animate-slide">
                    <div className="grid grid-cols-2 gap-4">
                        {SAMPLE_SERVICES.map(s => (
                            <button key={s.id} onClick={()=>handleSelect(s)} className={`card p-4 flex flex-col items-center gap-2 btn-press border-2 ${selected?.id===s.id ? 'border-primary' : 'border-transparent'}`}>
                                <i data-lucide={s.icon} className="w-8 h-8 text-primary"></i>
                                <span className="font-bold text-sm text-center">{s.name}</span>
                                <span className="text-xs bg-gray-100 px-2 py-1 rounded">{s.price === 0 ? 'Sur Devis' : formatMoney(s.price)}</span>
                            </button>
                        ))}
                    </div>

                    {selected && (
                        <div className="fixed bottom-0 left-0 right-0 bg-white p-6 rounded-t-3xl shadow-2xl z-40 animate-slide">
                            <h3 className="font-black text-xl mb-4 text-center">{selected.name}</h3>
                            <div className="flex gap-4 mb-4">
                                <div className="flex items-center justify-between bg-gray-100 rounded-xl p-2 w-1/2">
                                    <button onClick={()=>setQty(Math.max(1,qty-1))} className="w-10 h-10 bg-white rounded-lg shadow font-bold text-xl">-</button>
                                    <span className="font-black text-2xl">{qty}</span>
                                    <button onClick={()=>setQty(qty+1)} className="w-10 h-10 bg-white rounded-lg shadow font-bold text-xl">+</button>
                                </div>
                                {selected.price === 0 ? (
                                    <input type="number" placeholder="Prix Unitaire" className="w-1/2 bg-gray-100 rounded-xl p-3 font-bold text-center"
                                        value={customPrice} onChange={e=>setCustomPrice(e.target.value)} />
                                ) : (
                                    <div className="w-1/2 flex flex-col items-end justify-center pr-2">
                                        <span className="text-xs text-gray-400">TOTAL</span>
                                        <span className="font-black text-2xl text-primary">{formatMoney(selected.price * qty)}</span>
                                    </div>
                                )}
                            </div>
                            <div className="flex gap-2">
                                <button onClick={()=>setSelected(null)} className="flex-1 py-4 bg-gray-200 rounded-xl font-bold">Annuler</button>
                                <button onClick={validate} className="flex-[2] py-4 btn-primary rounded-xl font-bold shadow-lg">Valider</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- MODULE : STOCK (SAISIE FACTURE) ---
        const StockModule = ({ products, onRestock }) => {
            const [invoiceId, setInvoiceId] = useState("");
            const [selectedId, setSelectedId] = useState("");
            const [qty, setQty] = useState("");
            const [price, setPrice] = useState("");

            const handleSubmit = () => {
                if(!selectedId || !qty) return alert("Sélectionnez un produit et une quantité");
                onRestock(selectedId, parseInt(qty), price ? parseInt(price) : null, invoiceId || "Direct");
                alert("Stock mis à jour !");
                setQty(""); setPrice("");
            };

            return (
                <div className="p-4 pb-24 animate-slide">
                    <div className="card p-6 mb-6 border-2 border-dashed border-gray-300">
                        <div className="flex items-center gap-2 mb-4 text-primary">
                            <i data-lucide="clipboard-list"></i>
                            <h2 className="font-black text-lg">SAISIE ARRIVAGE / FACTURE</h2>
                        </div>
                        
                        <div className="space-y-4">
                            <div>
                                <label className="text-xs font-bold opacity-60">N° FACTURE / REFERENCE</label>
                                <input type="text" placeholder="Ex: FACT-2024-001" className="w-full p-3 bg-gray-100 rounded-xl font-mono font-bold" 
                                    value={invoiceId} onChange={e=>setInvoiceId(e.target.value)} />
                            </div>
                            
                            <div className="bg-gray-50 p-4 rounded-xl">
                                <label className="text-xs font-bold opacity-60">PRODUIT SUR LA FACTURE</label>
                                <select className="w-full p-3 bg-white rounded-xl font-bold mb-3 border" 
                                    value={selectedId} onChange={e=>setSelectedId(e.target.value)}>
                                    <option value="">-- Choisir un produit --</option>
                                    {products.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}
                                </select>
                                
                                <div className="flex gap-3">
                                    <div className="flex-1">
                                        <label className="text-xs font-bold opacity-60">QUANTITÉ RECUE</label>
                                        <input type="number" placeholder="0" className="w-full p-3 bg-white rounded-xl font-black text-xl border"
                                            value={qty} onChange={e=>setQty(e.target.value)} />
                                    </div>
                                    <div className="flex-1">
                                        <label className="text-xs font-bold opacity-60">PRIX VENTE (Unité)</label>
                                        <input type="number" placeholder="Optionnel" className="w-full p-3 bg-white rounded-xl font-bold text-xl border text-primary"
                                            value={price} onChange={e=>setPrice(e.target.value)} />
                                    </div>
                                </div>
                            </div>
                            
                            <button onClick={handleSubmit} className="w-full py-4 btn-primary rounded-xl font-black shadow-lg btn-press">
                                INCRÉMENTER LE STOCK
                            </button>
                        </div>
                    </div>

                    <h3 className="font-bold text-sm opacity-60 mb-2">ÉTAT DU STOCK ACTUEL</h3>
                    <div className="space-y-2">
                        {products.map(p => (
                            <div key={p.id} className="card p-3 flex justify-between items-center">
                                <span className="font-medium text-sm">{p.name}</span>
                                <span className={`font-bold px-2 py-1 rounded text-xs ${p.stock < 5 ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'}`}>
                                    {p.stock} unités
                                </span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPALE ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('dashboard'); // dashboard, shop, services, finance, stock
            const [theme, setTheme] = useState('theme-orange');
            
            // DONNÉES
            const [products, setProducts] = useState(SAMPLE_PRODUCTS);
            const [transactions, setTransactions] = useState([]);

            useEffect(() => { lucide.createIcons(); }, [view, user, products]);

            const toggleTheme = () => {
                const themes = ['theme-orange', 'theme-blue', 'theme-dark'];
                const next = themes[(themes.indexOf(theme) + 1) % themes.length];
                setTheme(next);
            };

            const addTransaction = (type, category, amount, desc) => {
                setTransactions([{ id: generateId(), date: Date.now(), type, category, amount, desc, by: user.name }, ...transactions]);
            };

            // Gestion Vente Boutique
            const handleShopSale = (cart, resetCart) => {
                if(!confirm("Valider cette vente ?")) return;
                const total = cart.reduce((a,c)=>a+(c.price*c.qty),0);
                
                // Maj Stock
                const newProds = products.map(p => {
                    const item = cart.find(c => c.id === p.id);
                    return item ? {...p, stock: p.stock - item.qty} : p;
                });
                setProducts(newProds);
                
                addTransaction('SALE', 'BOUTIQUE', total, `Vente ${cart.length} articles`);
                resetCart([]);
                setView('dashboard');
            };

            // Gestion Service
            const handleServiceSale = (name, qty, total) => {
                addTransaction('SALE', 'SERVICE', total, `${name} (x${qty})`);
                setView('dashboard');
            };

            // Gestion Stock
            const handleRestock = (pid, qty, newPrice, ref) => {
                setProducts(products.map(p => p.id === pid ? {...p, stock: p.stock + qty, price: newPrice || p.price} : p));
                addTransaction('LOG', 'STOCK', 0, `Arrivage ${ref}: +${qty} ${products.find(p=>p.id===pid).name}`);
            };

            // Écran de Connexion Simple
            if (!user) return (
                <div className={`app-container ${theme} flex flex-col items-center justify-center p-6`}>
                    <div className="w-24 h-24 rounded-3xl btn-primary flex items-center justify-center mb-6 shadow-xl">
                        <i data-lucide="shopping-bag" className="w-12 h-12 text-white"></i>
                    </div>
                    <h1 className="text-4xl font-black mb-8">ALISHASHOP</h1>
                    <div className="flex flex-col gap-4 w-full max-w-xs">
                        <button onClick={()=>setUser({name:'Patron', role:'Admin'})} className="py-4 bg-white text-black font-bold rounded-2xl shadow-lg btn-press">
                            Espace Gérant (Admin)
                        </button>
                        <button onClick={()=>setUser({name:'Vendeur', role:'Staff'})} className="py-4 btn-primary font-bold rounded-2xl shadow-lg btn-press">
                            Espace Vendeur
                        </button>
                    </div>
                </div>
            );

            // Dashboard Principal
            const Dashboard = () => (
                <div className="p-6 pt-4 animate-slide">
                    <div className="grid grid-cols-2 gap-4">
                        <button onClick={()=>setView('shop')} className="card p-6 flex flex-col items-center gap-3 btn-press">
                            <div className="w-12 h-12 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center"><i data-lucide="shopping-cart"></i></div>
                            <span className="font-black text-gray-800">BOUTIQUE</span>
                        </button>
                        <button onClick={()=>setView('services')} className="card p-6 flex flex-col items-center gap-3 btn-press">
                            <div className="w-12 h-12 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center"><i data-lucide="printer"></i></div>
                            <span className="font-black text-gray-800">SERVICES</span>
                        </button>
                        <button onClick={()=>setView('finance')} className="card p-6 flex flex-col items-center gap-3 btn-press">
                            <div className="w-12 h-12 rounded-full bg-green-100 text-green-600 flex items-center justify-center"><i data-lucide="smartphone"></i></div>
                            <span className="font-black text-gray-800">FINANCES</span>
                        </button>
                        {user.role === 'Admin' && (
                            <button onClick={()=>setView('stock')} className="card p-6 flex flex-col items-center gap-3 btn-press">
                                <div className="w-12 h-12 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center"><i data-lucide="package"></i></div>
                                <span className="font-black text-gray-800">STOCK</span>
                            </button>
                        )}
                    </div>
                    
                    <div className="mt-8">
                        <h3 className="font-bold text-lg mb-4">Aujourd'hui</h3>
                        <div className="card p-6 border-l-4 border-primary">
                            <div className="flex justify-between items-center mb-2">
                                <span className="text-sm opacity-60 font-bold">CAISSE TOTALE</span>
                                <i data-lucide="trending-up" className="text-primary"></i>
                            </div>
                            <p className="text-4xl font-black text-primary">
                                {formatMoney(transactions.reduce((a,t) => a + (t.type !== 'LOG' ? t.amount : 0), 0))}
                            </p>
                        </div>
                        <div className="mt-4 space-y-2">
                            {transactions.slice(0,5).map(t => (
                                <div key={t.id} className="bg-white/50 p-3 rounded-xl flex justify-between text-sm">
                                    <span>{t.desc}</span>
                                    <span className="font-bold">{t.type==='LOG' ? '-' : formatMoney(t.amount)}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );

            // Module Finance Simple
            const FinanceModule = () => {
                const [op, setOp] = useState('');
                const [amt, setAmt] = useState('');
                const handle = (type) => {
                    if(!op || !amt) return;
                    if(confirm(`${type} ${op} de ${amt}?`)) {
                        addTransaction('FINANCE', type, parseInt(amt), `${type} ${op}`);
                        setView('dashboard');
                    }
                };
                return (
                    <div className="p-4 animate-slide">
                        <div className="grid grid-cols-2 gap-3 mb-6">
                            {['Wave','Orange Money','Free','Wizall'].map(o => (
                                <button key={o} onClick={()=>setOp(o)} className={`p-4 rounded-xl font-bold border-2 ${op===o?'border-primary bg-white':'border-transparent bg-white/50'}`}>{o}</button>
                            ))}
                        </div>
                        <input type="number" placeholder="Montant" value={amt} onChange={e=>setAmt(e.target.value)} 
                            className="w-full p-4 rounded-xl bg-white mb-4 font-black text-2xl text-center outline-none" />
                        <div className="flex gap-4">
                            <button onClick={()=>handle('DEPOT')} className="flex-1 py-4 bg-green-500 text-white rounded-xl font-bold shadow-lg">DEPOT (Vert)</button>
                            <button onClick={()=>handle('RETRAIT')} className="flex-1 py-4 bg-red-500 text-white rounded-xl font-bold shadow-lg">RETRAIT (Rouge)</button>
                        </div>
                    </div>
                );
            };

            const getTitle = () => {
                switch(view) {
                    case 'shop': return 'Boutique';
                    case 'services': return 'Reprographie';
                    case 'stock': return 'Gestion Stock';
                    case 'finance': return 'Mobile Money';
                    default: return 'Tableau de Bord';
                }
            };

            return (
                <div className={`app-container ${theme}`}>
                    <Header 
                        title={getTitle()} 
                        user={user} 
                        view={view}
                        onBack={() => setView('dashboard')}
                        currentTheme={theme}
                        onToggleTheme={toggleTheme}
                    />
                    
                    <div className="max-w-md mx-auto">
                        {view === 'dashboard' && <Dashboard />}
                        {view === 'shop' && <ShopModule products={products} onSale={handleShopSale} />}
                        {view === 'services' && <ServicesModule onServiceSale={handleServiceSale} />}
                        {view === 'stock' && <StockModule products={products} onRestock={handleRestock} />}
                        {view === 'finance' && <FinanceModule />}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
